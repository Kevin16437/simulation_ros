#!/bin/bash

# 创建Gazebo仿真launch文件的脚本
# 为arm6项目创建ROS2版本的Gazebo launch文件

echo "创建Gazebo仿真launch文件..."

# 设置路径
SIMULATION_DIR="/mnt/f/F Download/simulation"
ARM6_DIR="$SIMULATION_DIR/arm6"

# 确保launch目录存在
mkdir -p "$ARM6_DIR/launch"

# 创建ROS2版本的Gazebo launch文件
cat > "$ARM6_DIR/launch/gazebo.launch.py" << 'EOF'
import os
from ament_index_python.packages import get_package_share_directory
from launch import LaunchDescription
from launch.actions import DeclareLaunchArgument, IncludeLaunchDescription, ExecuteProcess
from launch.launch_description_sources import PythonLaunchDescriptionSource
from launch.substitutions import LaunchConfiguration, Command
from launch_ros.actions import Node

def generate_launch_description():
    # 获取包路径
    pkg_path = get_package_share_directory('arm6')
    gazebo_ros_path = get_package_share_directory('gazebo_ros')
    
    # 声明参数
    use_sim_time = LaunchConfiguration('use_sim_time', default='true')
    world_file_name = 'empty.world'
    world = os.path.join(gazebo_ros_path, 'worlds', world_file_name)
    urdf_file_name = 'arm6.urdf.xacro'
    urdf = os.path.join(pkg_path, 'urdf', urdf_file_name)
    
    # 机器人描述
    robot_description_config = Command(['xacro ', urdf])
    
    # 参数声明
    declare_use_sim_time_cmd = DeclareLaunchArgument(
        'use_sim_time',
        default_value='true',
        description='Use simulation (Gazebo) clock if true'
    )
    
    declare_world_cmd = DeclareLaunchArgument(
        'world',
        default_value=world,
        description='Full path to world model file to load'
    )
    
    # Gazebo服务器
    start_gazebo_server_cmd = IncludeLaunchDescription(
        PythonLaunchDescriptionSource(
            os.path.join(gazebo_ros_path, 'launch', 'gzserver.launch.py')
        ),
        launch_arguments={'world': LaunchConfiguration('world')}.items()
    )
    
    # Gazebo客户端
    start_gazebo_client_cmd = IncludeLaunchDescription(
        PythonLaunchDescriptionSource(
            os.path.join(gazebo_ros_path, 'launch', 'gzclient.launch.py')
        )
    )
    
    # 机器人状态发布器
    robot_state_publisher_node = Node(
        package='robot_state_publisher',
        executable='robot_state_publisher',
        parameters=[{
            'robot_description': robot_description_config,
            'use_sim_time': use_sim_time
        }]
    )
    
    # 关节状态发布器
    joint_state_publisher_node = Node(
        package='joint_state_publisher',
        executable='joint_state_publisher',
        name='joint_state_publisher',
        parameters=[{'use_sim_time': use_sim_time}]
    )
    
    # 在Gazebo中生成机器人
    spawn_entity_node = Node(
        package='gazebo_ros',
        executable='spawn_entity.py',
        arguments=['-topic', 'robot_description',
                  '-entity', 'arm6',
                  '-x', '0.0',
                  '-y', '0.0',
                  '-z', '0.0'],
        output='screen'
    )
    
    return LaunchDescription([
        declare_use_sim_time_cmd,
        declare_world_cmd,
        start_gazebo_server_cmd,
        start_gazebo_client_cmd,
        robot_state_publisher_node,
        joint_state_publisher_node,
        spawn_entity_node
    ])
EOF

echo "已创建: gazebo.launch.py"

# 创建ROS1版本的Gazebo launch文件
cat > "$ARM6_DIR/launch/gazebo.launch" << 'EOF'
<launch>
  <!-- 启动空的Gazebo世界 -->
  <include file="$(find gazebo_ros)/launch/empty_world.launch">
    <arg name="paused" value="false"/>
    <arg name="use_sim_time" value="true"/>
    <arg name="gui" value="true"/>
    <arg name="headless" value="false"/>
    <arg name="debug" value="false"/>
  </include>

  <!-- 机器人描述参数 -->
  <param name="robot_description" command="$(find xacro)/xacro $(find arm6)/urdf/arm6.urdf.xacro" />

  <!-- 机器人状态发布器 -->
  <node name="robot_state_publisher" pkg="robot_state_publisher" type="robot_state_publisher" />

  <!-- 关节状态发布器 -->
  <node name="joint_state_publisher" pkg="joint_state_publisher" type="joint_state_publisher" />

  <!-- 在Gazebo中生成机器人 -->
  <node name="spawn_model" pkg="gazebo_ros" type="spawn_model"
        args="-param robot_description -urdf -model arm6 -x 0 -y 0 -z 0"
        output="screen" />

  <!-- TF变换发布器（如果需要） -->
  <node name="tf_footprint_base" pkg="tf" type="static_transform_publisher"
        args="0 0 0 0 0 0 base_link base_footprint 40" />

  <!-- 发布校准状态 -->
  <node name="fake_joint_calibration" pkg="rostopic" type="rostopic"
        args="pub /calibrated std_msgs/Bool true" />
</launch>
EOF

echo "已创建: gazebo.launch"

# 创建控制器配置文件
mkdir -p "$ARM6_DIR/config"

cat > "$ARM6_DIR/config/arm6_controllers.yaml" << 'EOF'
arm6_controller:
  type: effort_controllers/JointTrajectoryController
  joints:
    - j1
    - j2
    - j3
    - j4
    - j5
    - j6
  constraints:
    goal_time: 0.6
    stopped_velocity_tolerance: 0.05
    j1:
      trajectory: 0.1
      goal: 0.1
    j2:
      trajectory: 0.1
      goal: 0.1
    j3:
      trajectory: 0.1
      goal: 0.1
    j4:
      trajectory: 0.1
      goal: 0.1
    j5:
      trajectory: 0.1
      goal: 0.1
    j6:
      trajectory: 0.1
      goal: 0.1
  stop_trajectory_duration: 0.5
  state_publish_rate: 25
  action_monitor_rate: 10

joint_state_controller:
  type: joint_state_controller/JointStateController
  publish_rate: 50
EOF

echo "已创建: arm6_controllers.yaml"

# 创建RViz配置文件目录
mkdir -p "$ARM6_DIR/rviz"

cat > "$ARM6_DIR/rviz/urdf.rviz" << 'EOF'
Panels:
  - Class: rviz/Displays
    Help Height: 78
    Name: Displays
    Property Tree Widget:
      Expanded:
        - /Global Options1
        - /Status1
        - /RobotModel1
      Splitter Ratio: 0.5
    Tree Height: 557
  - Class: rviz/Selection
    Name: Selection
  - Class: rviz/Tool Properties
    Expanded:
      - /2D Pose Estimate1
      - /2D Nav Goal1
      - /Publish Point1
    Name: Tool Properties
    Splitter Ratio: 0.588679016
  - Class: rviz/Views
    Expanded:
      - /Current View1
    Name: Views
    Splitter Ratio: 0.5
  - Class: rviz/Time
    Experimental: false
    Name: Time
    SyncMode: 0
    SyncSource: ""
Visualization Manager:
  Class: ""
  Displays:
    - Alpha: 0.5
      Cell Size: 1
      Class: rviz/Grid
      Color: 160; 160; 164
      Enabled: true
      Line Style:
        Line Width: 0.0299999993
        Value: Lines
      Name: Grid
      Normal Cell Count: 0
      Offset:
        X: 0
        Y: 0
        Z: 0
      Plane: XY
      Plane Cell Count: 10
      Reference Frame: <Fixed Frame>
      Value: true
    - Alpha: 1
      Class: rviz/RobotModel
      Collision Enabled: false
      Enabled: true
      Links:
        All Links Enabled: true
        Expand Joint Details: false
        Expand Link Details: false
        Expand Tree: false
        Link Tree Style: Links in Alphabetic Order
      Name: RobotModel
      Robot Description: robot_description
      TF Prefix: ""
      Update Interval: 0
      Value: true
      Visual Enabled: true
    - Class: rviz/TF
      Enabled: true
      Frame Timeout: 15
      Frames:
        All Enabled: true
      Marker Scale: 1
      Name: TF
      Show Arrows: true
      Show Axes: true
      Show Names: true
      Tree:
        {}
      Update Interval: 0
      Value: true
  Enabled: true
  Global Options:
    Background Color: 48; 48; 48
    Default Light: true
    Fixed Frame: base_link
    Frame Rate: 30
  Name: root
  Tools:
    - Class: rviz/Interact
      Hide Inactive Objects: true
    - Class: rviz/MoveCamera
    - Class: rviz/Select
    - Class: rviz/FocusCamera
    - Class: rviz/Measure
    - Class: rviz/SetInitialPose
      Topic: /initialpose
    - Class: rviz/SetGoal
      Topic: /move_base_simple/goal
    - Class: rviz/PublishPoint
      Single click: true
      Topic: /clicked_point
  Value: true
  Views:
    Current:
      Class: rviz/Orbit
      Distance: 2.5
      Enable Stereo Rendering:
        Stereo Eye Separation: 0.0599999987
        Stereo Focal Distance: 1
        Swap Stereo Eyes: false
        Value: false
      Focal Point:
        X: 0
        Y: 0
        Z: 0
      Focal Shape Fixed Size: true
      Focal Shape Size: 0.0500000007
      Invert Z Axis: false
      Name: Current View
      Near Clip Distance: 0.00999999978
      Pitch: 0.785398006
      Target Frame: <Fixed Frame>
      Value: Orbit (rviz)
      Yaw: 0.785398006
    Saved: ~
Window Geometry:
  Displays:
    collapsed: false
  Height: 846
  Hide Left Dock: false
  Hide Right Dock: false
  QMainWindow State: 000000ff00000000fd000000040000000000000156000002c4fc0200000008fb0000001200530065006c0065006300740069006f006e00000001e10000009b0000006100fffffffb0000001e0054006f006f006c002000500072006f007000650072007400690065007302000001ed000001df00000185000000a3fb000000120056006900650077007300200054006f006f02000001df000002110000018500000122fb000000200054006f006f006c002000500072006f0070006500720074006900650073003203000002880000011d000002210000017afb000000100044006900730070006c0061007900730100000028000002c4000000d700fffffffb0000002000730065006c0065006300740069006f006e00200062007500660066006500720200000138000000aa0000023a00000294fb00000014005700690064006500530063007200650065006e0200000000000000000000000000000000fb0000000800540069006d00650100000000000004500000000000000000000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000000000000073f0000010f00ffffff000000020000073f00000000fc0100000001fb0000000a0056006900650077007300000069000000730000000000000000
  Selection:
    collapsed: false
  Time:
    collapsed: false
  Tool Properties:
    collapsed: false
  Views:
    collapsed: false
  Width: 1855
  X: 65
  Y: 24
EOF

echo "已创建: urdf.rviz配置文件"

echo "Gazebo仿真文件创建完成！"